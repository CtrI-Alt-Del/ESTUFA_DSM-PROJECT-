{% extends "layouts/dashboard/index.html" %}

{% from "components/modal.html" import modal %}
{% from "components/button.html" import button %}
{% from "components/datepicker.html" import datepicker %}
{% from "components/plant_select.html" import plant_select %}
{% from "components/loading.html" import loading %}
{% from "components/title.html" import title %}
{% from 'components/alert.html' import alert %}

{% block dashboard_content %}

{{ title("Registro da Checklist") }}

<div class="flex items-center justify-between mt-6">

  <a
    href="{{ url_for('checklist_records_views.checklist_records_dashboard_page_view') }}"
    class="flex items-center gap-1 p-2 px-2 border border-gray-800 rounded-md w-max">
    <i class="ph ph-presentation-chart"></i>
    Visualizar gr√°ficos
  </a>

  {{
  datepicker(
  attributes="data-table=filter",
  selected_start_date=selected_start_date,
  selected_end_date=selected_end_date,
  )
  }}

  {% call modal(id="create-checklist-records-modal") %}

  {% include
  "pages/checklist_records_table/create_checklist_record_form/index.html"
  %}

  {% endcall %}

  {{ button(
  title="Adicionar registro",
  attributes="data-modal-target=create-checklist-records-modal data-modal-toggle=create-checklist-records-modal")
  }}

</div>

{% call modal(id="update-checklist-record-modal") %}

<div id="update-checklist-record-form" class="flex w-full">
  <div class="grid place-content-center w-full h-[32rem]">
    {{ loading("w-24 h-24") }}
  </div>
</div>

{% endcall %}

<div class="relative pb-6 shadow-md sm:rounded-lg">
  <div class="flex items-end gap-3 p-6">
    <form
      id="filter-checklist-records-form"
      hx-get="{{ url_for('checklist_records_views.filter_checklist_records_view') }}"
      hx-target="#checklist-records"
      hx-swap="innerHTML"
      hx-include="#start-date, #end-date"
      hx-trigger="submit, change from:#plant-select, change from:#end-date"
      data-pagination="form"
      data-query-param="hx-get">
      {{
      plant_select(
      id="plant-select",
      plants=plants,
      can_include_all=True,
      attributes="data-table=filter",
      selected_plant_id=selected_plant_id
      )
      }}

      <input
        data-pagination="input"
        type="text"
        value="{{ current_page_number }}"
        hidden>
    </form>

    {{ alert() }}

    {{
    button(
    type="submit",
    title="Deletar registro(s)",
    attributes="id=delete-checklist-record-button data-table=delete-button form=delete-checklist-records-form",
    class="hidden bg-red-700 animate-pulse",
    )
    }}
  </div>

  <form
    id="delete-checklist-records-form"
    hx-delete="{{ url_for('checklist_records_views.delete_checklist_records_view') }}"
    hx-target="#checklist-records"
    hx-trigger="submit"
    hx-swap="innerHTML"
    data-query-param="hx-delete">
    <div
      id="checklist-records"
      data-table="container"
      data-pagination="container"
      class="flex flex-col justify-between h-[28rem]">
      {% include "pages/checklist_records_table/records.html" %}
    </div>
  </form>

</div>

<script
  src="{{ url_for('static', filename='scripts/query_param.js') }}"></script>

<script
  src="{{ url_for('static', filename='scripts/table.js') }}"></script>

<script
  src="{{ url_for('static', filename='scripts/pagination.js') }}"></script>

{% endblock dashboard_content %}